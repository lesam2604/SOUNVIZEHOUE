let e=null,r=null;async function n(){let a=$("#objectId").val();if(a)try{let{data:t}=await ajax({url:`${API_BASEURL}/card-orders/fetch/${a}`,type:"GET"});e=t}catch({error:t}){await Swal.fire(t.responseJSON.message,"","error"),location="/card-orders"}}function i(){const a=!!e.partner;$("#code").html(e.code),$("#codeClient").html(a?USER.hasRole("reviewer")?`<a href="/partners/${e.partner_id}">${e.partner.user.code}</a>`:e.partner.user.code:`<a href="/extra-clients/${e.extra_client_id}">${e.extra_client.code}</a>`),$("#lastName").html(a?e.partner.user.last_name:e.extra_client.last_name),$("#firstName").html(a?e.partner.user.first_name:e.extra_client.first_name),$("#companyName").html(a?e.partner.company.name:e.extra_client.company_name),$("#tin").html(a?e.partner.company.tin:e.extra_client.tin),$("#phoneNumber").html(a?e.partner.user.phone_number:e.extra_client.phone_number),r.draw()}async function o(){try{if(!(await Swal.fire({title:`Voulez-vous vraiment supprimer la commande de cartes ${e.code}?`,text:"Cette opÃ©ration est irreversible",icon:"question",showCancelButton:!0,confirmButtonText:"Oui",cancelButtonText:"Non"})).isConfirmed)throw{};swalLoading();let{data:t}=await ajax({url:`${API_BASEURL}/card-orders/delete/${e.id}`,type:"POST"});Toast.fire(t.message,"","success"),location="/card-orders"}catch({error:a}){Swal.fire(a.responseJSON.message,"","error")}}function c(){r=$("#tableCards").DataTable({deferLoading:0,processing:!0,serverSide:!0,columns:[{data:"__no__",name:"id"},{data:"card_id",name:"card_id"},{data:"category",name:"category"}],order:[0,"desc"],ajax:{url:`${API_BASEURL}/card-orders/list-cards`,type:"POST",dataType:"json",data:a=>{a.card_order_id=e.id},error:a=>{Swal.fire(a.responseJSON.message,"","error")}},pageLength:25,autoWidth:!1}),$("#tableCards").wrap('<div style="overflow-x: auto;"></div>')}window.render=async function(){await n(),c(),setTitle(`Details de la commande de carte ${e.code}`),$("#titleCards").html(`Liste des cartes sur la commande ${e.code}`),i(),$("#edit").click(function(a){location=`/card-orders/${e.id}/edit`}),$("#delete").click(function(a){o()}),$("#generateBill").click(function(a){a.preventDefault(),downloadFile(`${API_BASEURL}/card-orders/generate-bill/${e.id}`,"GET")})};
