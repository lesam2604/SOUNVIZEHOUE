let e=null;async function o(){let a=$("#objectId").val();if(a)try{let{data:r}=await ajax({url:`${API_BASEURL}/cards/fetch/${a}`,type:"GET"});e=r}catch({error:r}){await Swal.fire(r.responseJSON.message,"","error"),location="/cards"}}async function c(){try{let{data:a}=await ajax({url:`${API_BASEURL}/card-categories/fetch-all`,type:"GET"});$("#cardCategoryId").empty();for(const r of a)$("#cardCategoryId").append(`<option value="${r.id}">${r.name}</option>`)}catch({error:a}){await Swal.fire(a.responseJSON.message,"","error"),location="/cards"}}function t(){$("#cardCategoryId").val(""),clearCardAddingTypes(),$(".is-invalid").removeClass("is-invalid")}function d(){$("#cardCategoryId").val(e.card_category_id).attr("disabled",!0),$("#type").val("one").change().parent().hide(),$("#cardId").val(e.card_id)}async function s(){swalLoading();try{let{data:a}=await ajax({url:`${API_BASEURL}/cards/store`,type:"POST",data:fillCardAddingTypes({card_category_id:$("#cardCategoryId").val()})});Toast.fire(a.message,"","success"),t()}catch({error:a}){console.log(a),a.responseJSON.errors&&Swal.close(),showErrors(a.responseJSON,fillCardAddingErrorFields({card_category_id:"#cardCategoryId"}))}}async function i(){swalLoading();try{let{data:a}=await ajax({url:`${API_BASEURL}/cards/update/${e.id}`,type:"POST",data:{card_category_id:$("#cardCategoryId").val(),card_id:$("#cardId").val()}});Toast.fire(a.message,"","success"),location=`/cards/${e.id}`}catch({error:a}){console.log(a),viewErrors(a.responseJSON.errors)}}window.render=async function(){await Promise.all([o(),c()]),initCardAddingTypes(),setTitle(e?`Ã‰dition de la carte ${e.card_id}`:"Nouvelles cartes"),e?d():t(),$("#form").submit(function(a){a.preventDefault(),e?i():s()})};
