let r=null;async function n(){let{data:e}=await ajax({url:`${API_BASEURL}/decoders/total-stock`,type:"POST",data:{company_id:$("#companyId").val()}});$("#allDecoders").text(e.total),$("#activatedDecoders").text(e.activated??0),$("#notActivatedDecoders").text(e.not_activated??0)}function o(){r=$("#table").DataTable({processing:!0,serverSide:!0,columns:[{data:"__no__",name:"id"},{data:"decoder_number",name:"decoder_number",render:(e,t,a)=>USER.hasRole("reviewer")?`<a href="/decoders/${a.id}">${e}</a>`:e},{data:"order",name:"order",render:(e,t,a)=>`<a href="/decoder-orders/${a.decoder_order_id}">${e}</a>`},{data:"company",name:"company"},{data:"partner",name:"partner",render:(e,t,a)=>USER.hasRole("reviewer")?`<a href="/partners/${a.partner_id}">${e}</a>`:e},{data:"activated",name:"activated",render:(e,t,a)=>({Oui:'<span class="badge bg-success">Oui</span>',Non:'<span class="badge bg-danger">Non</span>'})[e]},{data:"operation_code",name:"operation_code",render:(e,t,a)=>e===null?"":USER.hasRole("reviewer")?`<a href="/operations/canal_activation/${a.operation_id}">${e}</a>`:e}],order:[0,"desc"],ajax:{url:`${API_BASEURL}/decoders/list-stock`,type:"POST",dataType:"json",data:e=>{e.company_id=$("#companyId").val(),e.status=$("#status").val()},error:e=>{console.log(e),Swal.fire(e.responseJSON.message,"","error")}},pageLength:25,autoWidth:!1,deferLoading:0}),$("#table").wrap('<div style="overflow-x: auto;"></div>')}window.render=async function(){o(),$("#companyId").change(function(){n()}),$("#companyId, #status").change(function(){r.draw()}),$("#status").val($("#paramStatus").val()),$("#companyId").change(),USER.hasRole("reviewer")?populateCompanies("#companyId"):$("#companyId").parent().toggleClass("d-flex d-none"),$("[data-status]").click(function(){$("#status").val($(this).data("status")).change()})};
