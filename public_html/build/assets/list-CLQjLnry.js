let t=null;function r(){t=$("#table").DataTable({processing:!0,serverSide:!0,columns:[{data:"__no__",name:"id"},{data:"code",name:"code",render:(a,n,e)=>`<a href="/partners/${e.id}">${a}</a>`},{data:"role",name:"role",render:(a,n,e)=>({"partner-master":'<span class="badge bg-primary">Principal</span>',"partner-pos":'<span class="badge bg-secondary">Boutique</span>'})[a]},{data:"first_name",name:"first_name"},{data:"last_name",name:"last_name"},{data:"company_name",name:"company_name"},{data:"phone_number",name:"phone_number"},{data:"email",name:"email"},{data:"balance",name:"balance",render:(a,n,e)=>a===null?"":formatAmount(a)},{data:"status",name:"status",render:(a,n,e)=>({pending:'<span class="badge rounded-pill bg-secondary">En attente</span>',enabled:'<span class="badge rounded-pill bg-success">Actif</span>',disabled:'<span class="badge rounded-pill bg-secondary">Inactif</span>',rejected:'<span class="badge rounded-pill bg-danger">Rejet√©</span>'})[a]}],order:[0,"desc"],ajax:{url:`${API_BASEURL}/partners/list`,type:"POST",dataType:"json",data:a=>{a.status=$("#status").val(),a.role=$("#role").val(),a.company_id=$("#companyId").val()},error:a=>{Swal.fire(a.responseJSON.message,"","error")}},pageLength:25,autoWidth:!1,deferLoading:0}),$("#table").wrap('<div style="overflow-x: auto;"></div>')}async function s(){let{data:a}=await ajax({url:`${API_BASEURL}/partners/total-balances`,type:"GET",data:{status:$("#status").val(),role:$("#role").val(),company_id:$("#companyId").val()}});$("#totalBalance").text(parseInt(a).toLocaleString("fr-FR"))}window.render=async function(){r(),USER.hasRole("reviewer")?await populateCompanies("#companyId"):$("#role, #companyId").parent().toggleClass("d-flex d-none"),$("#status, #role, #companyId").change(function(){s(),t.draw()}),$("#status").val($("#opStatus").val()).change()};
