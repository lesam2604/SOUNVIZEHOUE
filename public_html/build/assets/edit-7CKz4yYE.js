let e=null;async function n(){let a=$("#objectId").val();if(a)try{let{data:r}=await ajax({url:`${API_BASEURL}/partners/fetch/${a}`,type:"GET"});e=r,console.log(e)}catch({error:r}){await Swal.fire(r.responseJSON.message,"","error"),location="/partners"}}function t(){$("#firstName").val(e.user.first_name),$("#lastName").val(e.user.last_name),$("#phoneNumber").val(e.user.phone_number),$("#email").val(e.user.email),$("#confirmEmail").val(""),$("#idCardNumber").val(e.idcard_number),$("#address").val(e.address),$("#companyName").val(e.company.name),$("#tin").val(e.company.tin),$("#picture").val(""),$("#idCardPicture").val("")}async function i(){swalLoading();let a=new FormData;a.append("first_name",$("#firstName").val()),a.append("last_name",$("#lastName").val()),a.append("phone_number",$("#phoneNumber").val()),a.append("email",$("#email").val()),a.append("email_confirmation",$("#confirmEmail").val()),a.append("idcard_number",$("#idCardNumber").val()),a.append("address",$("#address").val()),a.append("company_name",$("#companyName").val()),a.append("tin",$("#tin").val()),a.append("picture",$("#picture")[0].files[0]??""),a.append("idcard_picture",$("#idCardPicture")[0].files[0]??"");try{let{data:r}=await ajax({url:`${API_BASEURL}/partners/update/${e.id}`,type:"POST",contentType:!1,processData:!1,data:a});Toast.fire(r.message,"","success"),location=`/partners/${e.id}`}catch({error:r}){console.log(r),r.responseJSON.errors&&Swal.close(),showErrors(r.responseJSON,{first_name:"#firstName",last_name:"#lastName",phone_number:"#phoneNumber",email:"#email",email_confirmation:"#confirmEmail",idcard_number:"#idCardNumber",address:"#address",company_name:"#companyName",tin:"#tin",picture:"#picture",idcard_picture:"#idCardPicture"})}}window.render=async function(){await n(),e.is_master||($("#companyName").parent().hide(),$("#tin").parent().hide()),setTitle(e.is_master?`Édition du partenaire ${e.user.code}`:`Édition de la boutique ${e.user.code}`),t(),$("#form").submit(function(a){a.preventDefault(),i()})};
