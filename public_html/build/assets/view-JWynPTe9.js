let t=null,o=null;async function r(){let e=$("#objectId").val();if(e)try{let{data:a}=await ajax({url:`${API_BASEURL}/inv-deliveries/fetch/${e}`,type:"GET"});t=a}catch({error:a}){await Swal.fire(a.responseJSON.message,"","error"),location="/inv-deliveries"}}function n(){$("#code").html(t.code),$("#invOrderCode").html(t.order.code),$("#clientFirstName").html(t.order.client_first_name),$("#clientLastName").html(t.order.client_last_name);for(const e of t.products){let a=t.order.products.find(i=>i.id===e.id);o.row.add({product_id:e.id,code:e.code,name:e.name,category_name:e.category.name,unit_price:a.pivot.unit_price,quantity:e.pivot.quantity,total_cost:a.pivot.unit_price*e.pivot.quantity})}o.draw()}async function c(){try{if(!(await Swal.fire({title:`Voulez-vous vraiment supprimer la livraison ${t.code}?`,text:"Cette opÃ©ration est irreversible",icon:"question",showCancelButton:!0,confirmButtonText:"Oui",cancelButtonText:"Non"})).isConfirmed)throw{};swalLoading();let{data:a}=await ajax({url:`${API_BASEURL}/inv-deliveries/delete/${t.id}`,type:"POST"});Toast.fire(a.message,"","success"),location="/inv-deliveries"}catch({error:e}){Swal.fire(e.responseJSON.message,"","error")}}function d(){o=$("#tableProducts").DataTable({columns:[{data:"code"},{data:"name"},{data:"category_name"},{data:"unit_price",render:(e,a,i)=>formatAmount(e)},{data:"quantity"},{data:"total_cost",render:(e,a,i)=>formatAmount(e)}],order:[0,"desc"],pageLength:25,autoWidth:!1}),$("#tableProducts").wrap('<div style="overflow-x: auto;"></div>')}window.render=async function(){await r(),d(),setTitle(`Details de la livraison ${t.code}`),$("#titleProducts").html(`Liste des produits sur la livraison ${t.code}`),n(),$("#edit").click(function(e){location=`/inv-deliveries/${t.id}/edit`}),$("#delete").click(function(e){c()})};
