let e=null;async function n(){let t=$("#objectId").val();if(t)try{let{data:a}=await ajax({url:`${API_BASEURL}/inv-products/fetch/${t}`,type:"GET"});e=a}catch({error:a}){await Swal.fire(a.responseJSON.message,"","error"),location="/inv-products"}}async function o(){try{let{data:t}=await ajax({url:`${API_BASEURL}/inv-categories/fetch-all`,type:"GET"});$("#categoryId").empty();for(const a of t)$("#categoryId").append(`<option value="${a.id}">${a.name}</option>`)}catch({error:t}){await Swal.fire(t.responseJSON.message,"","error"),location="/inv-products"}}function i(){$("#name").val(""),$("#unitPrice").val("0"),$("#categoryId").val(""),$("#stockQuantity").val("0"),$("#stockQuantityMin").val("0"),$("#picture").val(""),$(".update-image-helper").hide(),$(".is-invalid").removeClass("is-invalid")}function r(){$("#name").val(e.name),$("#unitPrice").val(e.unit_price),$("#categoryId").val(e.category_id).prop("disabled",!0),$("#stockQuantity").val(e.stock_quantity).prop("disabled",!0),$("#stockQuantityMin").val(e.stock_quantity_min),$("#picture").val("")}async function c(){swalLoading();let t=new FormData;t.append("name",$("#name").val()),t.append("unit_price",$("#unitPrice").val()),t.append("category_id",$("#categoryId").val()),t.append("stock_quantity",$("#stockQuantity").val()),t.append("stock_quantity_min",$("#stockQuantityMin").val()),t.append("picture",$("#picture")[0].files[0]??"");try{let{data:a}=await ajax({url:`${API_BASEURL}/inv-products/store`,type:"POST",contentType:!1,processData:!1,data:t});Toast.fire(a.message,"","success"),i()}catch({error:a}){console.log(a),a.responseJSON.errors&&Swal.close(),showErrors(a.responseJSON,{name:"#name",unit_price:"#unitPrice",category_id:"#categoryId",stock_quantity:"#stockQuantity",stock_quantity_min:"#stockQuantityMin",picture:"#picture"})}}async function s(){swalLoading();let t=new FormData;t.append("name",$("#name").val()),t.append("unit_price",$("#unitPrice").val()),t.append("stock_quantity_min",$("#stockQuantityMin").val()),t.append("picture",$("#picture")[0].files[0]??"");try{let{data:a}=await ajax({url:`${API_BASEURL}/inv-products/update/${e.id}`,type:"POST",contentType:!1,processData:!1,data:t});Toast.fire(a.message,"","success"),location=`/inv-products/${e.id}`}catch({error:a}){console.log(a),a.responseJSON.errors&&Swal.close(),showErrors(a.responseJSON,{name:"#name",unit_price:"#unitPrice",stock_quantity_min:"#stockQuantityMin",picture:"#picture"})}}window.render=async function(){await Promise.all([n(),o()]),setTitle(e?`Ã‰dition du produit ${e.code}`:"Nouveau produit"),e?r():i(),$("#form").submit(function(t){t.preventDefault(),e?s():c()})};
