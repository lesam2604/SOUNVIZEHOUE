let a=null,i=null;async function n(){let e=$("#objectId").val();if(e)try{let{data:t}=await ajax({url:`${API_BASEURL}/inv-orders/fetch/${e}`,type:"GET"});a=t}catch({error:t}){await Swal.fire(t.responseJSON.message,"","error"),location="/inv-orders"}}function c(){$("#code").html(a.code),$("#clientFirstName").html(a.client_first_name),$("#clientLastName").html(a.client_last_name);for(const e of a.products)i.row.add({product_id:e.id,code:e.code,name:e.name,category_name:e.category.name,unit_price:e.pivot.unit_price,quantity:e.pivot.quantity,total_cost:e.pivot.unit_price*e.pivot.quantity});i.draw()}async function s(){try{if(!(await Swal.fire({title:`Voulez-vous vraiment supprimer la commande ${a.code}?`,text:"Cette opération est irreversible",icon:"question",showCancelButton:!0,confirmButtonText:"Oui",cancelButtonText:"Non"})).isConfirmed)throw{};swalLoading();let{data:t}=await ajax({url:`${API_BASEURL}/inv-orders/delete/${a.id}`,type:"POST"});Toast.fire(t.message,"","success"),location="/inv-orders"}catch({error:e}){Swal.fire(e.responseJSON.message,"","error")}}function d(){i=$("#tableProducts").DataTable({columns:[{data:"code"},{data:"name"},{data:"category_name"},{data:"unit_price",render:(e,t,r)=>formatAmount(e)},{data:"quantity"},{data:"total_cost",render:(e,t,r)=>formatAmount(e)}],order:[0,"desc"],pageLength:25,autoWidth:!1}),$("#tableProducts").wrap('<div style="overflow-x: auto;"></div>')}window.render=async function(){await n(),d(),setTitle(`Details de la commande ${a.code}`),$("#titleProducts").html(`Liste des produits sur la commande ${a.code}`),c(),$("#edit").click(function(t){location=`/inv-orders/${a.id}/edit`}),$("#delete").click(function(t){s()});async function e(t){var r;try{swalLoading();const{data:o}=await ajax({url:`${API_BASEURL}/inv-orders/approve/${a.id}`,type:"POST",data:{is_paid:t?"true":"false"}});Toast.fire(o.message||"Commande validée.","","success"),location.reload()}catch({error:o}){Swal.fire(((r=o==null?void 0:o.responseJSON)==null?void 0:r.message)||"Erreur","","error")}}$("#approvePaid").on("click",()=>e(!0)),$("#approveUnpaid").on("click",()=>e(!1))};
