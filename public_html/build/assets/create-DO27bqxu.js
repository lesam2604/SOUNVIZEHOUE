let a=null,o=null;async function r(){let e=$("#objectId").val();if(e)try{let{data:t}=await ajax({url:`${API_BASEURL}/broadcast-messages/fetch/${e}`,type:"GET"});a=t}catch({error:t}){await Swal.fire(t.responseJSON.message,"","error"),location="/broadcast-messages"}}function s(){$("#label").val(""),o.root.innerHTML="",$("#group").val("all"),$(".is-invalid").removeClass("is-invalid")}function l(){$("#label").val(a.label),o.root.innerHTML=a.content,$("#group").val(a.group)}async function n(){swalLoading();try{let{data:e}=await ajax({url:`${API_BASEURL}/broadcast-messages/store`,type:"POST",data:{label:$("#label").val(),content:o.root.innerHTML,group:$("#group").val()}});Toast.fire(e.message,"","success"),s()}catch({error:e}){console.log(e),e.responseJSON.errors&&Swal.close(),showErrors(e.responseJSON)}}async function i(){swalLoading();try{let{data:e}=await ajax({url:`${API_BASEURL}/broadcast-messages/update/${a.id}`,type:"POST",data:{label:$("#label").val(),content:o.root.innerHTML,group:$("#group").val()}});Toast.fire(e.message,"","success"),location=`/broadcast-messages/${a.id}`}catch({error:e}){console.log(e),e.responseJSON.errors&&Swal.close(),showErrors(e.responseJSON)}}window.render=async function(){await r(),o=new Quill("#content",{modules:{toolbar:[[{font:[]},{size:[]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{script:"super"},{script:"sub"}],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["direction",{align:[]}],["clean"]]},theme:"snow",placeholder:"Entrez le contenu de votre message ici"}),setTitle(a?`Édition du message de diffusion «${a.label}»`:"Nouveau message de diffusion"),a?l():s(),$("#form").submit(function(e){e.preventDefault(),a?i():n()})};
