let a=null;async function t(){let e=$("#objectId").val();if(e)try{let{data:o}=await ajax({url:`${API_BASEURL}/scrolling-messages/fetch/${e}`,type:"GET"});a=o}catch({error:o}){await Swal.fire(o.responseJSON.message,"","error"),location="/scrolling-messages"}}function l(){$("#label").val(""),$("#content").val(""),$("#from").val(""),$("#to").val(""),$("#time").val("0"),$("#size").val(""),$("#color").val(""),$("#show_auth").val("0"),$("#show_app").val("0"),$(".is-invalid").removeClass("is-invalid")}function s(){$("#label").val(a.label),$("#content").val(a.content),$("#from").val(a.from?moment(a.from).format("YYYY-MM-DD"):""),$("#to").val(a.to?moment(a.to).format("YYYY-MM-DD"):""),$("#time").val(a.time),$("#size").val(a.size),$("#color").val(a.color),$("#show_auth").val(a.show_auth),$("#show_app").val(a.show_app)}async function r(){swalLoading();try{let{data:e}=await ajax({url:`${API_BASEURL}/scrolling-messages/store`,type:"POST",data:{label:$("#label").val(),content:$("#content").val(),from:$("#from").val(),to:$("#to").val(),time:$("#time").val(),size:$("#size").val(),color:$("#color").val(),show_auth:$("#show_auth").val(),show_app:$("#show_app").val()}});Toast.fire(e.message,"","success"),l()}catch({error:e}){console.log(e),e.responseJSON.errors&&Swal.close(),showErrors(e.responseJSON)}}async function n(){swalLoading();try{let{data:e}=await ajax({url:`${API_BASEURL}/scrolling-messages/update/${a.id}`,type:"POST",data:{label:$("#label").val(),content:$("#content").val(),from:$("#from").val(),to:$("#to").val(),time:$("#time").val(),size:$("#size").val(),color:$("#color").val(),show_auth:$("#show_auth").val(),show_app:$("#show_app").val()}});Toast.fire(e.message,"","success"),location=`/scrolling-messages/${a.id}`}catch({error:e}){console.log(e),e.responseJSON.errors&&Swal.close(),showErrors(e.responseJSON)}}window.render=async function(){await t(),setTitle(a?`Édition du message «${a.label}»`:"Nouveau message"),a?s():l(),$("#form").submit(function(e){e.preventDefault(),a?n():r()})};
