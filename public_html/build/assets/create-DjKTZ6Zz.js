let a=null;async function r(){let t=$("#objectId").val();if(t)try{let{data:e}=await ajax({url:`${API_BASEURL}/inv-supplies/fetch/${t}`,type:"GET"});a=e}catch({error:e}){await Swal.fire(e.responseJSON.message,"","error"),location="/inv-supplies"}}async function i(){try{let{data:t}=await ajax({url:`${API_BASEURL}/inv-products/fetch-all`,type:"GET"});$("#productId").empty();for(const e of t)$("#productId").append(`<option value="${e.id}">${e.name}</option>`)}catch({error:t}){await Swal.fire(t.responseJSON.message,"","error"),location="/inv-supplies"}}function o(){$("#productId").val("").change(),$("#quantity").val("0"),$(".update-image-helper").hide(),$(".is-invalid").removeClass("is-invalid")}function n(){$("#productId").val(a.product_id).change(),$("#quantity").val(a.quantity)}async function s(){swalLoading();try{let{data:t}=await ajax({url:`${API_BASEURL}/inv-supplies/store`,type:"POST",data:{product_id:$("#productId").val(),quantity:$("#quantity").val()}});Toast.fire(t.message,"","success"),o()}catch({error:t}){console.log(t),t.responseJSON.errors&&Swal.close(),showErrors(t.responseJSON,{product_id:"#productId",quantity:"#quantity"})}}async function c(){swalLoading();try{let{data:t}=await ajax({url:`${API_BASEURL}/inv-supplies/update/${a.id}`,type:"POST",data:{product_id:$("#productId").val(),quantity:$("#quantity").val()}});Toast.fire(t.message,"","success"),location=`/inv-supplies/${a.id}`}catch({error:t}){console.log(t),t.responseJSON.errors&&Swal.close(),showErrors(t.responseJSON,{product_id:"#productId",quantity:"#quantity"})}}window.render=async function(){await Promise.all([r(),i()]),setTitle(a?`Ã‰dition de l'approvisionnement ${a.code}`:"Nouvel approvisionnement"),a?n():o(),$("#form").submit(function(t){t.preventDefault(),a?c():s()})};
