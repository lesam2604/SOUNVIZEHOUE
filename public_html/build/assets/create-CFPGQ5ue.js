let t=null;async function a(){let e=$("#objectId").val();if(e)try{let{data:r}=await ajax({url:`${API_BASEURL}/inv-deliveries/fetch/${e}`,type:"GET"});t=r}catch({error:r}){await Swal.fire(r.responseJSON.message,"","error"),location="/inv-deliveries"}}async function o(){try{let{data:e}=await ajax({url:`${API_BASEURL}/inv-orders/fetch-all`,type:"GET"});$("#invOrderId").empty();for(const r of e)$("#invOrderId").append(`
        <option value="${r.id}" data-products="${htmlEntities(JSON.stringify(r.products))}">
          ${r.client_first_name} ${r.client_last_name}
        </option>
      `)}catch({error:e}){await Swal.fire(e.responseJSON.message,"","error"),location="/inv-deliveries"}}function i(){$("#invOrderId").val(""),clearProductAdding(),$(".is-invalid").removeClass("is-invalid")}function d(){$("#invOrderId").val(t.order_id).prop("disabled"),setProductAdding(t.products)}async function n(){swalLoading();try{let{data:e}=await ajax({url:`${API_BASEURL}/inv-deliveries/store`,type:"POST",data:fillProductAdding({order_id:$("#invOrderId").val()})});Toast.fire(e.message,"","success"),i()}catch({error:e}){console.log(e),e.responseJSON.errors&&Swal.close(),showErrors(e.responseJSON,{order_id:"#invOrderId"})}}async function s(){swalLoading();try{let{data:e}=await ajax({url:`${API_BASEURL}/inv-deliveries/update/${t.id}`,type:"POST",data:fillProductAdding({})});Toast.fire(e.message,"","success"),i()}catch({error:e}){console.log(e),e.responseJSON.errors&&Swal.close(),showErrors(e.responseJSON)}}window.render=async function(){await Promise.all([a(),o()]),initProductAdding(),$("#invOrderId").change(function(){populateProductAdding($(this).find("option:selected").data("products"))}),setTitle(t?`Ã‰dition de la livraison ${t.code}`:"Nouvelle livraison"),t?d():i(),$("#form").submit(function(e){e.preventDefault(),t?s():n()})};
