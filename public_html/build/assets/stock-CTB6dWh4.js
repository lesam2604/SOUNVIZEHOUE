let r=null;async function n(){let{data:a}=await ajax({url:`${API_BASEURL}/cards/total-stock`,type:"POST",data:{company_id:$("#companyId").val()}});$("#allCards").text(a.total),$("#activatedCards").text(a.activated??0),$("#notActivatedCards").text(a.not_activated??0)}function d(){r=$("#table").DataTable({processing:!0,serverSide:!0,columns:[{data:"__no__",name:"id"},{data:"card_id",name:"card_id",render:(a,t,e)=>USER.hasRole("reviewer")?`<a href="/cards/${e.id}">${a}</a>`:a},{data:"category",name:"category",render:(a,t,e)=>USER.hasRole("reviewer")?`<a href="/card-categories/${e.card_category_id}">${a}</a>`:a},{data:"order",name:"order",render:(a,t,e)=>`<a href="/card-orders/${e.card_order_id}">${a}</a>`},{data:"company",name:"company"},{data:"partner",name:"partner",render:(a,t,e)=>USER.hasRole("reviewer")?`<a href="/partners/${e.partner_id}">${a}</a>`:a},{data:"activated",name:"activated",render:(a,t,e)=>({Oui:'<span class="badge bg-success">Oui</span>',Non:'<span class="badge bg-danger">Non</span>'})[a]},{data:"operation_code",name:"operation_code",render:(a,t,e)=>a===null?"":USER.hasRole("reviewer")?`<a href="/operations/card_activation/${e.operation_id}">${a}</a>`:a}],order:[0,"desc"],ajax:{url:`${API_BASEURL}/cards/list-stock`,type:"POST",dataType:"json",data:a=>{a.company_id=$("#companyId").val(),a.status=$("#status").val()},error:a=>{console.log(a),Swal.fire(a.responseJSON.message,"","error")}},pageLength:25,autoWidth:!1,deferLoading:0}),$("#table").wrap('<div style="overflow-x: auto;"></div>')}window.render=async function(){d(),$("#companyId").change(function(){n()}),$("#companyId, #status").change(function(){r.draw()}),$("#status").val($("#paramStatus").val()),$("#companyId").change(),USER.hasRole("reviewer")?populateCompanies("#companyId"):$("#companyId").parent().toggleClass("d-flex d-none"),$("[data-status]").click(function(){$("#status").val($(this).data("status")).change()})};
