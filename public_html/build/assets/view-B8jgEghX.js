let e=null,a=null;async function o(){let r=$("#objectId").val();if(r)try{let{data:t}=await ajax({url:`${API_BASEURL}/decoder-orders/fetch/${r}`,type:"GET"});e=t}catch({error:t}){await Swal.fire(t.responseJSON.message,"","error"),location="/decoder-orders"}}function n(){const r=!!e.partner;$("#code").html(e.code),$("#codeClient").html(r?USER.hasRole("reviewer")?`<a href="/partners/${e.partner_id}">${e.partner.user.code}</a>`:e.partner.user.code:`<a href="/extra-clients/${e.extra_client_id}">${e.extra_client.code}</a>`),$("#lastName").html(r?e.partner.user.last_name:e.extra_client.last_name),$("#firstName").html(r?e.partner.user.first_name:e.extra_client.first_name),$("#companyName").html(r?e.partner.company.name:e.extra_client.company_name),$("#tin").html(r?e.partner.company.tin:e.extra_client.tin),$("#phoneNumber").html(r?e.partner.user.phone_number:e.extra_client.phone_number),a.draw()}async function d(){if((await Swal.fire({title:`Voulez-vous vraiment supprimer la commande de décodeur ${e.code}?`,text:"Cette opération est irreversible",icon:"question",showCancelButton:!0,confirmButtonText:"Oui",cancelButtonText:"Non"})).isConfirmed)try{swalLoading();let{data:t}=await ajax({url:`${API_BASEURL}/decoder-orders/delete/${e.id}`,type:"POST"});Toast.fire(t.message,"","success"),location="/decoder-orders"}catch({error:t}){Swal.fire(t.responseJSON.message,"","error")}}function c(){a=$("#tableDecoders").DataTable({deferLoading:0,processing:!0,serverSide:!0,columns:[{data:"__no__",name:"id"},{data:"decoder_number",name:"decoder_number"}],order:[0,"desc"],ajax:{url:`${API_BASEURL}/decoder-orders/list-decoders`,type:"POST",dataType:"json",data:r=>{r.decoder_order_id=e.id},error:r=>{Swal.fire(r.responseJSON.message,"","error")}},pageLength:25,autoWidth:!1}),$("#tableDecoders").wrap('<div style="overflow-x: auto;"></div>')}window.render=async function(){await o(),c(),setTitle(`Details de la commande de décodeur ${e.code}`),$("#titleDecoders").html(`Liste des décodeurs sur la commande ${e.code}`),n(),$("#edit").click(function(r){location=`/decoder-orders/${e.id}/edit`}),$("#delete").click(function(r){d()}),$("#generateBill").click(function(r){r.preventDefault(),downloadFile(`${API_BASEURL}/decoder-orders/generate-bill/${e.id}`,"GET")})};
